var names = ["Pixelephant", "Ninjavu", "Pignorant", "Plazy", "Pandaily", "Tweetail", "Coillness", "Evillan", "Lazyhazy", "Sniperil", "Accentaur", "Aggrobot", "Alfairy", "Alpaking", "Alphairy", "Alphantom", "Amighost", "Amigod", "Amigoliath", "Annaconda", "Antelopez", "Antiger", "Apeshifter", "Apexecutioner", "Aquasp", "ArchLizard", "Armydillo", "Aromaster", "Asprince", "Asprincess", "Autoad", "Babeast", "Baboom", "Babuccaneer", "Bachelord", "Baconjurer", "Baconqueror", "Badept", "Badgericho", "Bambinosaur", "Bambooccaneer", "Bamboozle", "Banditch", "Banditto", "Bandroid", "Bansheep", "Barnaclue", "Baroqueen", "Barracupid", "Barrycuda", "Basalamander", "Bassassin", "Basshopper", "BearCrawl", "BearGills", "Bearry", "BeastLee", "Beastern", "Beauty-Rex", "Beezenees", "Behemote", "Binghost", "Bingoblin", "Bingod", "Bingoddess", "Bingoliath", "Blazebra", "Bluffalo", "Boaris", "Bombeast", "Bonghost", "Bongoliath", "Bonsiren", "Boohooligan", "Brassassin", "Brasshopper", "Broncoco", "Brutea", "Brutee-Rex", "BuffaLou", "Buffaloris", "Bullfrogert", "BumbleBeast", "BumbleBeetle", "BumblingBee", "BunBunny", "Butcherry", "Butterflight", "Butterflux", "C-Horse", "C-Lion", "Calamarauder", "Camella", "Camperor", "Candroid", "Capeshifter", "Caribooboo", "Cariboohoo", "Caterpixie", "Caterpolaris", "Catnip", "Celestiger", "Centaura", "Centaurora", "Champeon", "Cheatah", "Chieftaint", "Chimpanther", "Chimpantzer", "Chimpanzer", "Chimpanzy", "Chinchillax", "Chinchilling", "Chipmunkey", "Chosenpai", "Cicadaemon", "Cinnamonster", "Civillain", "Classhopper", "Cloverlord", "Cloverseer", "Coalossus", "Cobrag", "Cobrass", "Cobrawl", "Cocowboy", "Cocowgirl", "Colossubs", "Commandrogenic", "Commandroid", "Conjursa", "Conquerogue", "Conquerry", "Consoldier", "Consoul", "Controll", "Corsairier", "Corsairway", "Cougarfield", "Cougarry", "Cowhale", "Coyotea", "Coyoteerex", "Creaturret", "Crickettle", "Criminail", "Critturtle", "Croccultist", "Crocodino", "Crocodoom", "Crocodoris", "Cubeast", "Cyaninja", "Cybora", "Cybork", "Cyborne", "Cycloth", "Daemonk", "Daemonkey", "Daemonster", "Decorsair", "Delhiminate", "Demonkey", "Demonster", "Devile", "Devillain", "Dimwitch", "Dingoal", "Dingopher", "Dinomite", "Dinosause", "Dinoscythe", "Dinosoaring", "Dismage", "Dismaiden", "Dismister", "Diwrecktor", "Dolphine", "Dolphinkle", "Domignome", "DonKiwi", "Donkeychain", "Draccoon", "Dragonflight", "Dragonightmare", "Drummingbird", "Duelf", "Duskunk", "Dwarvo", "Dwarvos", "Eggcecutioner", "Elephantom", "Eliminature", "Eliminatured", "Emoo", "Emperoar", "Emprescue", "Emufasa", "Emufassa", "Emutant", "Enchantra", "Essaint", "Eurobot", "ExTermite", "Executie", "Eyewearwolf", "Falconartist", "Falcondor", "Falconjure", "Falconjurer", "Fearkat", "Fellama", "Festivalkyrie", "Fiendure", "Flaminghost", "Flamingoal", "Flamingoat", "Flamingopher", "Flexecutioner", "Fowlee", "Frenchanter", "Froghurt", "Frostrich", "Fuguru", "Gamercenary", "Gamermaid", "Gamerman", "Gangstereo", "Gangsteroids", "Geckoco", "Geishadow", "Gerbilbo", "Ghostrich", "GiantPandaisy", "GiantPandame", "GiantPandamonium", "Giantics", "Gibbonbon", "Gigangster", "Giraffiki", "Giraffle", "Gladiablo", "Glamorc", "Glasshopper", "Globster", "Gnunou", "Goath", "Gobling", "Goghost", "Goliatlas", "Gooze", "Gopherrel", "Gorillala", "Gorillamp", "Gorillax", "Gorrilag", "Gorrilava", "Grammarauder", "Grampaladin", "Grapeshifter", "Grasshiphopper", "Griffinish", "Griffinished", "Griffinite", "Griffinkle", "Griminal", "Grincubus", "Gringoblin", "Gringoliath", "GuacaMole", "GuineaPiggy", "GuineaPiglet", "Guruse", "Hamsteroids", "Harlequill", "Havoccultist", "Hawkeye", "Hawkward", "Hedgehawk", "Hedgehoax", "Hedgehog", "Hedgehogger", "Herobot", "Herogue", "Herose", "Herover", "Herringmaster", "Hexecutioner", "Hijackal", "Hippolice", "Hippony", "Hippopotamouse", "Hitmanatee", "Hitmantis", "Hobogre", "HoneyBeetle", "HoneyBeezenees", "Hornettle", "Hoverlord", "Hydroid", "Hydrone", "Hyenada", "Hyenanana", "Hypnotastic", "Hypnotwist", "Hypogre", "Ibiscuit", "Ibiscus", "Iconjurer", "Impaladin", "Incubugs", "Incubuzz", "Indighost", "Indigoliath", "Infergnome", "Jackalf", "Jaguardo", "Jaguwar", "Jalapegnome", "Javampire", "Jellyfists", "Jollygator", "Judgenie", "Judgerm", "Kangaroar", "Kangaroodle", "Kangarookie", "Kappaladin", "Karmagician", "Kegnome", "Kimognome", "Knightclub", "Knighthawk", "Knightingale", "Knightlife", "Knightmare", "Knightshade", "Knighttime", "Koalala", "Koalarry", "Koalassy", "Koalava", "KomodoreDragon", "Komodough", "Komodozer", "Lamagician", "Lamaster", "Laserpent", "Lassassin", "Latignome", "Lavampire", "Lemonster", "Lemurmur", "Leopardon", "Leoparty", "Leprecocoa", "Leprecorn", "Leviatank", "Liquidathor", "Liquidatorus", "Llamaths", "Lobsteroid", "Lobsteroids", "Lockroach", "Locustard", "Loghost", "Macaward", "Madept", "Magmaster", "Magpiechart", "MammothMoth", "Manateerex", "Manghost", "Mantissue", "Marauderby", "Masteroid", "MatriarchAngel", "MatriarchMage", "Mavericksha", "Maybeast", "Meerkatnip", "Megangster", "Metrobot", "Minerd", "Misteroid", "Mobsteroid", "Mobsteroids", "Mockroach", "Monkeyno", "Monkiwi", "Mosquiche", "Mosquitar", "Mosquite", "Mosquitoxic", "Muskunk", "Mutantra", "Napaladin", "Ninja", "Ninjafar", "Ninjava", "Nitrobot", "Nitrogue", "Nitrover", "Nitwitch", "Numbat", "Ocelotus", "Octopirate", "Octopixy", "Octopuds", "Octopuppy", "Ogremlin", "Omegangster", "Omenforcer", "Orangutangle", "Orangutango", "Orangutank", "Orangutitan", "Origamister", "Ostricheyrich", "Ostritches", "Otterminate", "Otterror", "Ownerd", "OysterSauce", "Oysterminate", "Oystrich", "Paladino", "Pandaisy", "Pandame", "Pandamonium", "Pandata", "Panthermal", "Panthermic", "Paparazzombie", "Parascythe", "Parasike", "Parasyclops", "Parrotting", "PatriachAngel", "PatriarchMage", "Patrio", "Patriode", "Patroll", "Peafowlet", "Pedroid", "Pelgriminal", "Pelgrimp", "Pelicancan", "Pelicandy", "Pelicanine", "Pelicannon", "Penguinee", "Phantomahawk", "Phantomato", "Phantomb", "Phantomboy", "Phantomcat", "Phantomfool", "Pheasantics", "Phoenexus", "Phoenixia", "Piagnome", "Pigloo", "Pignite", "Pillagerman", "Pionearly", "Pitapatriot", "Pixelf", "Pixigh", "Poltergeisha", "Ponylon", "Ponymph", "Porcupid", "Porcupie", "Porcupike", "Porcupint", "Porcupity", "Porcupixel", "Porpoison", "Potatoad", "Preaster", "Prepatriarch", "Priestar", "Priestyle", "Proccultist", "Proctopus", "Pupillager", "Pygmeanie", "Pyrobot", "Pyrogre", "Pyrogue", "Quailment", "Rabbite", "Rabbyte", "Rangerman", "Raptortilla", "Raptortoise", "Rascalf", "Rebelf", "Reconjurer", "Recyclops", "RedHerring", "RedPandaisy", "RedPandame", "Rerunner", "Rerunt", "Retrobot", "Retrogue", "Revenano", "Rhignome", "Rhinocerious", "Rhinosaur", "Rivalkyrie", "Robottom", "Roguerrilla", "Roverlord", "Roverseer", "Sailorc", "Sailord", "Sailore", "Sailoreal", "Saladiator", "Salamaniac", "Salamantis", "Salmonkey", "Salmonster", "Samuraider", "Sardiner", "Sasquire", "Sassassin", "Scampirate", "Scarabyte", "Scentaur", "Scorpeon", "Scraptor", "SeaLionness", "Sealectric", "Sealite", "Sealixir", "Sellamander", "Sewarlock", "Irrelephant", "Sha-Doh", "Shadept", "Sharcade", "Sharctic", "Sheeple", "Sincubus", "Sirenforcer", "Sirental", "Sitcommander", "Slayerk", "Slother", "Slotherworld", "Slotherworldly", "SnailMail", "Snailment", "Snakebab", "Sniperipheral", "Sniperks", "Sniperv", "Snowmanta", "Snowmantis", "Sockroach", "Soyster", "Spaladin", "Sparasite", "Sparrowling", "Specterminate", "Spiderby", "Spillager", "Spookworm", "Spreest", "Spright", "Squidiot", "Squidle", "Squidol", "Starfishht", "Starfissure", "Starfist", "Stenchanter", "StingRaymond", "Stingraider", "StingrayCharles", "Stinkbuggy", "Stoutlaw", "Succubusted", "Sukiyaking", "Sultank", "Sultantrum", "Sumogre", "Sundaemon", "Sunraider", "SwallowRider", "Tabooccaneer", "Tabutcher", "Tangoddess", "Techgnome", "Teriyaking", "Termight", "Termime", "Termitis", "Thortoise", "Titank", "Tomatoad", "Totemperor", "Totemplar", "Toucancan", "Toucandy", "Toucane", "Toucannon", "Toucanoe", "Tourtoise", "Trollout", "Troutlaw", "Troutwards", "Tsardine", "Turbandit", "Turbanshee", "Turbogre", "Turkiwi", "Twilightingale", "Typogre", "Unbandit", "Unbanshee", "Uniqueen", "Urchinchilla", "Valord", "Vanillama", "Vertighost", "Victorc", "Videogre", "Vikingkong", "Vikingpin", "Vipersia", "Volcagnome", "Vulturret", "Wahooligan", "Wallaby", "Walruse", "Warachnid", "Warhawk", "Warlocket", "Warthawk", "Waspear", "Weaselfie", "Wenchanter", "Wincubus", "Windighost", "Witchy", "Wizart", "Wolferal", "Wolfire", "Wolveriot", "Wolverival", "Wombait", "Wombattalion", "Wombattle", "Womblast", "Woodpecan", "Woodpecs", "Wrathhawk", "Wrathhog", "Yahooligan", "Yakar", "Yetea", "Zebrag", "Zebrass", "Zebrawl", "Zerobot"];
var tempUsers = [{ name: "Joe", curPage: "https://en.wikipedia.org/wiki/Silence_of_the_North", pages: 3 }, { name: "Joe", curPage: "https://en.wikipedia.org/wiki/La_Estacion_Theme_Park", pages: 6 }, { name: "Joe", curPage: "https://en.wikipedia.org/wiki/Maltese_people_in_the_United_Kingdom", pages: 9 }];

document.addEventListener('DOMContentLoaded', function () {
    chrome.storage.sync.get('startPageTitle', function (item) {
        var startPage = document.getElementById('startPage');
        startPage.value = item.startPageTitle;
    });

    chrome.storage.sync.get('endPageTitle', function (item) {
        var endPage = document.getElementById('endPage');
        endPage.value = item.endPageTitle;
    });

    chrome.storage.sync.get('userName', function (item) {
        var userName = document.getElementById('userName');
        if (item.userName != null) {
            userName.value = item.userName;
        } else {
            userName.value = names[Math.floor(Math.random() * names.length)];
        }
    });

    document.getElementById("startGame").onclick = function () {
        fetch("http://universe-game.v6p2dfukmp.us-east-1.elasticbeanstalk.com/api/get_current_game", {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (response) {
            return response.json();
        }).then(function (body) {
            var json = body.status;
            if (!Object.keys(json.players).includes(document.getElementById("userName").value)) {
                var startPage = json.start_page;
                var endPage = json.end_page;
                var startTitle = json.start_page_title;
                var endTitle = json.end_page_title;

                fetch('http://universe-game.v6p2dfukmp.us-east-1.elasticbeanstalk.com/api/submit_update', {
                    method: 'post',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: document.getElementById("userName").value, page: startTitle })
                }).then(res => res.json())
                    .then(res => console.log(res));

                loadUsers();
                document.getElementById("startPage").value = startTitle;
                document.getElementById("endPage").value = endTitle;
                chrome.storage.sync.set({ 'startPageTitle': startTitle }, function () { });
                chrome.storage.sync.set({ 'endPageTitle': endTitle }, function () { });
                chrome.storage.sync.set({ 'startPage': startPage }, function () { });
                chrome.storage.sync.set({ 'endPage': endPage }, function () { });
                chrome.tabs.update({ url: startPage });
                chrome.storage.sync.set({ 'gameInProgress': true }, function () { });
                chrome.storage.sync.set({ 'userName': document.getElementById("userName").value }, function () { });
            }
        });
    }

    document.getElementById("createNewGame").onclick = function () {
        fetch('http://universe-game.v6p2dfukmp.us-east-1.elasticbeanstalk.com/api/start_new_game').then(res => res.json())
            .then(res => {
                var json = res.status;
                var startPage = json.start_page;
                var endPage = json.end_page;
                var startTitle = json.start_page_title;
                var endTitle = json.end_page_title;

                fetch('http://universe-game.v6p2dfukmp.us-east-1.elasticbeanstalk.com/api/submit_update', {
                    method: 'post',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: document.getElementById("userName").value, page: startTitle })
                }).then(res => res.json())
                    .then(res => console.log(res));

                document.getElementById("startPage").value = startTitle;
                document.getElementById("endPage").value = endTitle;
                chrome.storage.sync.set({ 'startPageTitle': startTitle }, function () { });
                chrome.storage.sync.set({ 'endPageTitle': endTitle }, function () { });
                chrome.storage.sync.set({ 'startPage': startPage }, function () { });
                chrome.storage.sync.set({ 'endPage': endPage }, function () { });
                chrome.tabs.update({ url: startPage });
                chrome.storage.sync.set({ 'gameInProgress': true }, function () { });
                chrome.storage.sync.set({ 'userName': document.getElementById("userName").value }, function () { });
                // var username = document.getElementById("userName").value;
                var players = res.status.players

                loadUsers();

                for (entry of Object.keys(players)) {
                    var entries = players[entry];
                    $('.container').append('<li class="item"> <div class="avatar" style="background-image: url(svg/' + entry.charAt(0) + '.svg); background-size: 75%; background-repeat: no-repeat; background-position: center;"></div> <div class="text"> <h1>' + entry + '</h1><br /> <p>' + entries[entries.length - 1] + '</p> </div> <div class="distance"> <span>' + (players[entry].length + 1) + '</span> </div> </li>');
                };
            });

    }

    loadUsers();
});

function loadUsers() {
    fetch('http://universe-game.v6p2dfukmp.us-east-1.elasticbeanstalk.com/api/get_current_game').then(res => res.json())
        .then(res => {
            $('.container li').remove();
            var username = document.getElementById("userName").value;
            var players = res.status.players
            console.log(res);
            for (entry of Object.keys(players)) {
                var entries = players[entry];
                $('.container').append('<li class="item"> <div class="avatar" style="background-image: url(svg/' + entry.charAt(0) + '.svg); background-size: 75%; background-repeat: no-repeat; background-position: center;"></div> <div class="text"> <h1>' + entry + '</h1> <p>' + entries[entries.length - 1] + '</p> </div> <div class="distance"> <span>' + (players[entry].length) + '</span> </div> </li>');
            };
        });
}

//Get title from Wikipedia url
function getTitle(url) {
    return url.split("/wiki/")[1].replace(/_/g, " ");
}